/* (c) Copyright 2007-2013 Xoron GmbH */
"use strict";var image_editor={};(function(){var ah="/images/cursors";var aQ=100;var m=1;var t=[5,10,20,30,40,50,60,70,80,90,100,150,200,300,400,500,600,700,800,900,1000,1100,1200,1300,1400,1500,1600,1700,1800,1900,2000];var q=6;var a2=2000;var aq=0;var H=["pipette","mover","hotspot","eraser","inverted"];var j={pipette:{filename:"pipette.cur",hotspot_x:0,hotspot_y:14,dashed_border:true,alternative:"help"},mover:{filename:"mover.cur",hotspot_x:7,hotspot_y:7,dashed_border:false,alternative:"move"},hotspot:{filename:"hotspot.cur",hotspot_x:7,hotspot_y:7,dashed_border:false,alternative:"crosshair"},eraser:{filename:"eraser.cur",dashed_border:true,alternative:"pointer"},inverted:{filename:"inverted.cur",dashed_border:true},pen:{filename:"pen.cur",dashed_border:true,alternative:"pointer"},};var r=184;var aV=1000;var ae=600;var D=19;var V=11;var o=11;var u=[{left:(o+Math.round(r*2/3)),top:(V+2*D),delay:ae},{left:o,top:V,delay:(ae*2)},{left:(o+r),top:V,delay:ae},{left:o,top:(V+D),delay:(ae*2)}];var aD="000000";var aa=2;var ba=2;var aI=1.2;var T;var bi;var ao;var aY;var w;var Y;var bd;var e;var p;var az;var X=[];var h;var n;var k;var aB;var bj;var a4;var Q;var ad;var aP;var bh;var a;var a3;var af;var ax;var ar;var W;image_editor.initialize_page=function(){if(jQuery("#big_icon").length){a7()}else{if(jQuery("#import_form").length){y()}else{if(jQuery("#contact_form").length){bf()}else{if(jQuery("#star").length||jQuery("#comment_link").length||jQuery("#download_copy_form").length){ab()}}}}};image_editor.change_last_used_colors=function(){if(!Y){return}var bo;for(bo=1;bo<q+1;bo++){if(Y[0]===Y[bo]){return}}var bp;for(bp=q+1;bp>0;bp--){Y[bp]=Y[bp-1]}var bn;for(bn=0;bn<q;bn++){if(Y[bn+1]==="inv"){jQuery("#current_color_box_"+bn).css("backgroundImage",'url("images/cell_inverted.png")');ag(jQuery("#current_color_box_"+bn),1)}else{jQuery("#current_color_box_"+bn).css("backgroundImage","");jQuery("#current_color_box_"+bn).css("background","#"+Y[bn+1].substr(0,6));ag(jQuery("#current_color_box_"+bn),parseInt(Y[bn+1].substr(6,2),16)/255)}}};image_editor.set_transparency=function(bn){jQuery("#alpha_transparency").slider("value",255-bn)};image_editor.pen_selected=function(){aA("pen");aX()};image_editor.tool_checked=function(bn){if(bn==="inverted"){Z()}if(jQuery("#"+bn).prop("checked")){aA(bn)}aX();if((bn==="eraser")||(bn==="inverted")){image_editor.change_last_used_colors()}};image_editor.tool_clicked=function(bn){if(jQuery("#"+bn).prop("checked")){jQuery("#"+bn).prop("checked",false)}else{jQuery("#"+bn).prop("checked",true)}image_editor.tool_checked(bn)};image_editor.animate_preview_checked=function(){if(jQuery("#animate_preview").prop("checked")){af=1;B()}else{a9()}};image_editor.last_color_clicked=function(bo){var bn=Y[bo+1];if(bn==="00000000"){jQuery("#eraser").prop("checked",true);aA("eraser");image_editor.change_last_used_colors()}else{if(bn==="inv"){jQuery("#inverted").prop("checked",true);aA("inverted");image_editor.change_last_used_colors()}else{aA("pen");color_picker.set_hex_color(bn)}}aX()};image_editor.current_color_clicked=function(){if((!jQuery("#eraser").prop("checked")&&(!jQuery("#inverted").prop("checked")))){image_editor.pen_selected()}};image_editor.frame_duration_changed=function(){a[aP]=jQuery("#frame_duration option:selected").val();return(true)};function ab(){star_rating.initialize();jQuery("#comment_link").click(function(){aZ();return(false)});jQuery(".download_copy").click(function(){jQuery("#download_copy_form").submit();return(false)})}function al(){var bn='<form>Width: <input id="image_width" name="image_width" type="text" value="'+az+'" style="width: 30px;" />, ';bn+='Height: <input id="image_height" name="image_height" type="text" value="'+p+'" style="width: 30px;" /> ';bn+='<input id="change_size_button" type="button" value="Change" /></form>';jQuery("#resizer").html(bn);jQuery("#change_size_button").on("click",a6)}function b(){var bG=[];var bo;for(bo=1;bo<=p;bo++){bG[bo]=[];var br;for(br=1;br<=az;br++){var bq=bh[aP][bo][br].substr(6,2);if(bq!=="00"){bG[bo][br]=aD+aO(parseInt(bq,16))}else{bG[bo][br]="00000000"}}}var bH;for(bH=p;bH>=1;bH--){bG[bo]=[];var bv;for(bv=az;bv>=1;bv--){var bA;if((bH-aa>0)&&(bv-ba>0)){bA=bG[bH-aa][bv-ba]}else{bA="00000000"}bG[bH][bv]=bA}}var bx=[];var bC;for(bC=1;bC<=p;bC++){bx[bC]=[];var bt;for(bt=1;bt<=az;bt++){var bJ=0;var bn=0;var bE;for(bE=-3;bE<=3;bE++){if((bC+bE>=1)&&(bC+bE<=p)){bn++;var by=Math.pow(Math.E,-Math.pow(Math.abs(bE),2)/(2*Math.pow(aI,2)))/(2*Math.PI*Math.pow(aI,2));bJ+=parseInt(bG[bC+bE][bt].substr(6,2),16)*by}}bx[bC][bt]=bG[bC][bt].substr(0,6)+aO(bJ)}}var bz=[];var bB;for(bB=1;bB<=p;bB++){bz[bB]=[];var bs;for(bs=1;bs<=az;bs++){var bK=0;var bp=0;var bF;for(bF=-1;bF<=1;bF++){if((bs+bF>=1)&&(bs+bF<=p)){bp++;bK+=parseInt(bx[bB][bs+bF].substr(6,2),16)}}bK=bK/bp;bz[bB][bs]=bx[bB][bs].substr(0,6)+aO(bK)}}var bD;for(bD=1;bD<=p;bD++){var bu;for(bu=1;bu<=az;bu++){bz[bD][bu]=A(bh[aP][bD][bu],bz[bD][bu])}}var bI;for(bI=1;bI<=p;bI++){var bw;for(bw=1;bw<=az;bw++){bh[aP][bI][bw]=bz[bI][bw]}}aw()}function Z(){var bp;row_loop:for(bp=1;bp<=p;bp++){var bn;for(bn=1;bn<=az;bn++){var bo=bh[aP][bp][bn].substr(6,2).toLowerCase();if((bo!=="ff")&&(bo!=="00")){alert("It's not possible to use alpha transparency and inverted pixels in the same cursor image. Please remove either alpha transparency or don't use inverted pixels. Full transparency is allowed.");break row_loop}}}}function I(){h=0;k=0;aB=0;bj=0;a4=0;Q=1;n=[];var bn;for(bn=1;bn<=p;bn++){n[bn]=[]}}function d(){var bp=1;if(!bh){bh=[];a=[];if(jQuery("#frame_count")){a3=parseInt(jQuery("#frame_count").val(),10);jQuery("#iterations").val(jQuery("#iteration_count").val());var bt;for(bt=1;bt<=a3;bt++){bh[bt]=[];var bs;for(bs=1;bs<=p;bs++){bh[bt][bs]=[];var br="#"+i(bs,bt);if(jQuery(br).length){bp=0;var bq=jQuery(br).val();var bn;for(bn=1;bn<=az;bn++){if(bq.match(/^inv/)){bq=bq.replace(/^inv/,"");bh[bt][bs][bn]="inv"}else{if(bq.match(/^[\dA-F]{8}/i)){bh[bt][bs][bn]=bq.match(/^[\dA-F]{8}/i)[0];bq=bq.replace(/^[\dA-F]{8}/i,"")}else{alert("parsing error in row "+bs+": "+bq)}}}}else{var bo;for(bo=1;bo<=az;bo++){bh[bt][bs][bo]="00000000"}}}if(jQuery("#delays-f"+bt).val()){a[bt]=aM(jQuery("#delays-f"+bt).val())}else{a[bt]=100*m}}}else{l(1)}if(F()){am();aJ()}}else{bp=0}return(bp)}function F(){if(jQuery("#animation_frame").length){return(1)}return(0)}function J(){T=[];bi=[];ao=[];var bo;for(bo=1;bo<=p;bo++){T[bo]=[];bi[bo]=[];ao[bo]=[];var bn;for(bn=1;bn<=az;bn++){T[bo][bn]=jQuery("#big-r"+bo+"c"+bn);bi[bo][bn]=T[bo][bn].parent();ao[bo][bn]=jQuery("#small-r"+bo+"c"+bn)}}}function l(bp){bh[bp]=[];var bo;for(bo=1;bo<=p;bo++){bh[bp][bo]=[];var bn;for(bn=1;bn<=az;bn++){bh[bp][bo][bn]="00000000"}}a[bp]=100;a3=bp}function aF(){var bn=[];var bu;for(bu=1;bu<=p;bu++){var bp;for(bp=1;bp<=az;bp++){var bo=bh[aP][bu][bp];if((bo!=="00000000")&&(bo!=="inv")){if(!bn[bo]){bn[bo]=1}else{bn[bo]++}}}}var bt=f(bn,function(bw,bv){if(bn[bw]>bn[bv]){return(-1)}else{if(bn[bw]<bn[bv]){return(1)}}return(0)});var br;for(br=0;br<q+1;br++){if(bt[q+1-br]){var bs=bt[q+1-br].key;Y[0]=bs;image_editor.change_last_used_colors()}}if(bt[0]){var bq=bt[0].key;color_picker.set_hex_color(bq);Y[0]=bq}}function O(){Y=[];var bn;for(bn=0;bn<q+1;bn++){Y[bn]="00000000"}}function f(bo,bq){var bp=[];var bn;for(bn in bo){if(bo.hasOwnProperty(bn)){bp.push({key:bn,value:bo[bn]})}}bp.sort(function(br,bs){return bq(br.key,bs.key)});return bp}function c(bn){if(bn.which===1){w=1;aT(bn)}else{if(bn.which===3){w=2;aT(bn,1)}}return(false)}function R(){w=0;if(jQuery("#mover").prop("checked")){h=0}return(false)}function aN(bn){if(w===1){aT(bn)}else{if(w===2){aT(bn,1)}}return(false)}function at(){w=0;if(jQuery("#mover").prop("checked")){h=0}return}function aT(bq,bp){var bo=bq.currentTarget.id;if(!/big-r\d+c\d+/.test(bo)){bo=jQuery(bq.currentTarget).children()[0].id;if(!/big-r\d+c\d+/.test(bo)){return(true)}}var bs=bo.match(/big-r(\d+)c(\d+)/);var br=parseInt(bs[1],10);var bn=parseInt(bs[2],10);if(jQuery("#eraser").prop("checked")||bp){ai(br,bn)}else{if(jQuery("#inverted").prop("checked")||bp){be(br,bn)}else{if(jQuery("#pipette").prop("checked")){aC(br,bn)}else{if(jQuery("#mover").prop("checked")){x(br,bn)}else{if(jQuery("#hotspot").length&&jQuery("#hotspot").prop("checked")){au(br,bn)}else{aS(br,bn)}}}}}}function x(bt,bo){if(!h){h=1;if(Q){k=bt;aB=bo;var br;for(br=1;br<=p;br++){var bn;for(bn=1;bn<=az;bn++){n[br][bn]=bh[aP][br][bn]}}Q=0}else{k=k-bj+bt;aB=aB-a4+bo}}else{if((bj!==bt)||(a4!==bo)){var bq;for(bq=1;bq<=p;bq++){var bs;for(bs=1;bs<=az;bs++){var bp=bq+k-bt;var bu=bs+aB-bo;if((bp>0)&&(bp<=p)&&(bu>0)&&(bu<=az)){aG(bq,bs,n[bp][bu])}else{aG(bq,bs,"00000000")}}}}}bj=bt;a4=bo}function aS(bq,bo){Q=1;var bp=ay();var bn=jQuery("#color_hex_string").text()+aO(bp);aG(bq,bo,bn);Y[0]=bn}function ay(){var bn=255-jQuery("#alpha_transparency").slider("value");return(bn)}function an(){jQuery("#alpha_transparency").slider({max:255,min:0,step:1,slide:function(bn,bo){s(bo.value)}})}function s(bn){jQuery("#alpha_transparency").slider("value",bn);image_editor.pen_selected();image_editor.change_last_used_colors()}function ai(bo,bn){Q=1;aG(bo,bn,"00000000");Y[0]="00000000"}function be(bo,bn){Q=1;aG(bo,bn,"inv");Y[0]="inv"}function aG(bq,bo,bn,bp){if((bh[aP][bq][bo]!==bn)||bp){P(bq,bo,bn);bh[aP][bq][bo]=bn}}function P(bt,bq,bp){if(bp==="inv"){T[bt][bq].css("backgroundImage",'url("images/cell_inverted.png")');ag(T[bt][bq],1);if((a3===1)||(!jQuery("#animate_preview").prop("checked"))){ao[bt][bq].css("backgroundColor","#000000");ag(ao[bt][bq],1)}if(ad){aY.fillStyle="#000000";aY.fillRect(bq-1,bt-1,1,1)}}else{var bn=bp.substr(0,2);var bs=bp.substr(2,2);var bo=bp.substr(4,2);var br=parseInt(bp.substr(6,2),16)/255;T[bt][bq].css("backgroundColor","#"+bn+bs+bo);ag(T[bt][bq],br);T[bt][bq].css("backgroundImage","");if((a3===1)||(!jQuery("#animate_preview").prop("checked"))){ao[bt][bq].css("backgroundColor","#"+bn+bs+bo);ag(ao[bt][bq],br)}if(ad){if(br!==1){aY.clearRect(bq-1,bt-1,1,1)}aY.fillStyle="rgba("+parseInt(bn,16)+","+parseInt(bs,16)+","+parseInt(bo,16)+","+br+")";aY.fillRect(bq-1,bt-1,1,1)}}if(!bd){bd=true;jQuery("#preview_message").fadeOut("slow",function(){jQuery("#cursor_preview").fadeIn("slow")});a5()}}function ag(bo,bn){bo.css("opacity",bn)}function av(){if(bd){var bo=jQuery("#page_favicon")[0];var bn=bo.cloneNode(true);bn.setAttribute("href",aY.canvas.toDataURL());bo.parentNode.replaceChild(bn,bo)}window.setTimeout(av,a2)}function aC(bp,bo){Q=1;var bn=bh[aP][bp][bo];if(bn==="inv"){jQuery("#pipette").prop("checked",false);jQuery("#inverted").prop("checked",true)}else{jQuery("#pipette").prop("checked",false);if(bn==="00000000"){jQuery("#eraser").prop("checked",true)}else{jQuery("#eraser").prop("checked",false)}color_picker.set_hex_color(bn)}aX()}function au(bo,bn){w=0;K(bo-1,bn-1)}function i(bo,bn){return("points-r"+bo+"f"+bn)}function aA(bn){var bo;for(bo=0;bo<H.length;bo++){if(H[bo]!==bn){if(jQuery("#"+H[bo]).length){jQuery("#"+H[bo]).prop("checked",false)}}}}function aX(){var bo;if(jQuery("#pipette").prop("checked")){bo="pipette"}else{if(jQuery("#mover").prop("checked")){bo="mover"}else{if(jQuery("#hotspot").length&&jQuery("#hotspot").prop("checked")){bo="hotspot"}else{if(jQuery("#eraser").prop("checked")){bo="eraser"}else{if(jQuery("#inverted").prop("checked")){bo="inverted"}else{bo="pen"}}}}}var bn="auto";if("alternative" in j[bo]){bn=j[bo].alternative}if((!jQuery.browser.msie)&&(!jQuery.browser.opera)&&("hotspot_x" in j[bo])&&("hotspot_y" in j[bo])){jQuery("#big_icon").css("cursor",'url("'+ah+"/"+j[bo].filename+'") '+j[bo].hotspot_x+" "+j[bo].hotspot_y+", "+bn)}else{jQuery("#big_icon").css("cursor",'url("'+ah+"/"+j[bo].filename+'"), '+bn)}if(j[bo].dashed_border){jQuery(".big_icon_background").addClass("big_icon_element_hover")}else{jQuery(".big_icon_background").removeClass("big_icon_element_hover")}if(jQuery("#eraser").prop("checked")){jQuery("#big_current_color_box").css("backgroundImage","");ag(jQuery("#big_current_color_box"),0)}else{if(jQuery("#inverted").prop("checked")){jQuery("#big_current_color_box").css("backgroundImage",'url("images/cell_inverted.png")');ag(jQuery("#big_current_color_box"),1)}else{var bp=ay()/255;if(bp==1){jQuery("#transparency_percentage").html("")}else{jQuery("#transparency_percentage").html(": "+parseInt((1-bp)*100,10).toString()+"%")}ag(jQuery("#big_current_color_box"),bp);jQuery("#big_current_color_box").css("backgroundImage","")}}}function bk(){if(aP<aQ){aP++}if(aP>a3){aP=1}a9()}function bl(){aP--;if(aP<1){if(parseInt(jQuery("#iterations").val(),10)!==1){aP=a3}else{aP=1}}a9()}function a9(bq){jQuery("#frame_no").text(aP);jQuery("#frame_count_display").text(a3);am();var bp=false;if(!bq){var br;for(br=1;br<=p;br++){var bo;for(bo=1;bo<=az;bo++){var bn=bh[aP][br][bo];if(((br>16)||(bo>16))&&(bn!=="00000000")&&(jQuery("#link_bigger").css("display")!=="none")){bp=true}P(br,bo,bn)}}}if(bp){aj(true,0)}}function aL(){jQuery("#hidden_fields").empty();N("hidden_fields","frame_count",a3);if(F()){N("hidden_fields","iter_count",jQuery("#iterations").val())}else{N("hidden_fields","iter_count",1)}var bq;for(bq=1;bq<=a3;bq++){var bp;for(bp=1;bp<=p;bp++){var bo="";var bn;for(bn=1;bn<=az;bn++){bo+=bh[bq][bp][bn]}N("hidden_fields",i(bp,bq),bo)}N("hidden_fields","delays-f"+bq,a[bq])}if(ax){N("hidden_fields","hotspot_row",ax);N("hidden_fields","hotspot_column",ar)}}function N(bn,bo,bp){jQuery("#"+bn).append('<input type="hidden" name="'+bo+'" value="'+bp+'">')}function bb(){jQuery("#action_flag").val("download_icon");aL();jQuery("#download_icon").submit()}function aH(){jQuery("#action_flag").val("download_cursor");aL();jQuery("#download_icon").submit()}function E(){jQuery("#action_flag").val("download_image");aL();jQuery("#download_icon").submit()}function bc(){jQuery("#action_flag").val("publish_request");aL();jQuery("#download_icon").submit()}function am(){if(a3>aP){jQuery("#animation_next_text").text("Next");jQuery("#animation_next_arrow").css("display","inline");jQuery("#loop_next").css("display","none")}else{if(a3===aP){if((parseInt(jQuery("#iterations").val(),10)!==1)&&(a3!==1)){jQuery("#animation_next_text").text("First");jQuery("#animation_next_arrow").css("display","inline");jQuery("#loop_next").css("display","inline")}else{jQuery("#animation_next_arrow").css("display","none")}}}if(aP>1){jQuery("#animation_previous_text").text("Previous");jQuery("#animation_previous_arrow").css("display","inline");jQuery("#loop_previous").css("display","none")}else{if((parseInt(jQuery("#iterations").val(),10)===1)||(a3===1)){jQuery("#animation_previous_arrow").css("display","none")}else{jQuery("#animation_previous_text").text("Last");jQuery("#animation_previous_arrow").css("display","inline");jQuery("#loop_previous").css("display","inline")}}jQuery("#frame_duration").val(a[aP]);jQuery("#frame_count_display").text(a3);jQuery("#frame_no").text(aP)}function bm(bt){if(bt){var bs;outer_loop:for(bs=1;bs<=p;bs++){var bn;for(bn=1;bn<=az;bn++){var bp=bh[aP][bs][bn].substr(6,2).toLowerCase();if((bp!=="ff")&&(bp!=="00")){if(confirm("Animated images cannot use alpha transparency. Do you want to make all pixels opaque or fully transparent?")){var bq;for(bq=1;bq<=p;bq++){var bo;for(bo=1;bo<=az;bo++){var br=bh[aP][bq][bo].substr(6,2).toLowerCase();if((br!=="ff")&&(br!=="00")){aG(bq,bo,bh[aP][bq][bo].substr(0,6)+"FF",1)}}}break outer_loop}else{return}}}}jQuery("#transparency_box").slideUp("slow");jQuery("#animation_frame").slideDown("slow",function(){jQuery("#animation_link_show").hide();jQuery("#animation_link_hide").show()});am();image_editor.set_transparency(255);image_editor.pen_selected()}else{if(a3>1){if(confirm("Do you really want to delete all frames except this one?")){if(aP>1){bh.splice(1,aP-1)}if(a3>aP){bh.splice(2)}a3=1;aP=1}else{return}}jQuery("#transparency_box").slideDown("slow");jQuery("#animation_frame").slideUp("slow",function(){jQuery("#animation_link_hide").hide();jQuery("#animation_link_show").show()})}return}function G(){if(aP>1){var bo;for(bo=1;bo<=p;bo++){var bn;for(bn=1;bn<=az;bn++){aG(bo,bn,bh[aP-1][bo][bn],1)}}}}function U(){var bo;for(bo=1;bo<=p;bo++){var bn;for(bn=1;bn<=az;bn++){aG(bo,bn,"00000000",1)}}}function M(){a3++;l(a3);a[a3]=a[aP];aP=a3;U();am()}function ak(){if(a3<2){U();return}if(confirm("Do you really want to delete this frame?")){a3--;bh.splice(aP,1);if(a3<aP){aP=a3}aw();am()}}function aw(){var bo;for(bo=1;bo<=p;bo++){var bn;for(bn=1;bn<=az;bn++){P(bo,bn,bh[aP][bo][bn])}}}function aM(bn){var bo=t[0];var bp;for(bp=0;bp<t.length;bp++){if(bn>=t[bp]){bo=t[bp]}else{if(bn<t[bp]){break}}}return(bo)}function B(){if(jQuery("#animate_preview").prop("checked")){if(af>a3){af=1}var bq;for(bq=1;bq<=p;bq++){var bo;for(bo=1;bo<=az;bo++){var bn=bh[af][bq][bo];if(bn==="inv"){ao[bq][bo].css("backgroundColor","#000000");ag(ao[bq][bo],1)}else{var bp=bn.substr(0,6);ao[bq][bo].css("backgroundColor","#"+bp);ag(ao[bq][bo],parseInt(bn.substr(6,2),16)/255)}}}af++;window.setTimeout(B,a[af-1]*10)}}function aJ(){af=1;B()}function aZ(){jQuery("#comments_form").show("slow");jQuery("#comment_link").hide();jQuery("#comments_textarea").focus()}function bf(){W=jQuery.now();jQuery("#contact_form").submit(aK)}function y(){jQuery("#import_form").submit(aW);jQuery.preLoadImages("images/import/activity_indicator.gif")}function aK(){var bo=jQuery.now()-W;var bn=jQuery("<input>").attr("type","hidden").attr("name","typing_duration").val(bo);jQuery("#contact_form").append(jQuery(bn));return true}function aW(){jQuery("body").append('<div id="wait_window" style="top: '+aR(200)+"px; left: "+ac(300)+'px;"><p><h1 style="margin: 0 1em;">Uploading...</h1><p/><img src="images/import/activity_indicator.gif" style="margin-top: 40px;" /></div>');return true}function ac(bn){if(jQuery(window).width()>bn){return Math.round((jQuery(window).width()-bn)/2)}return 0}function aR(bn){if(jQuery(window).height()>bn){return Math.round((jQuery(window).height()-bn)/3)}return 0}function a8(bn){bn.preventDefault()}function ap(bq){var br=bq.dataTransfer;var bp=br.files;bq.preventDefault();var bo;for(bo=0;bo<bp.length;bo++){var bn=bp[bo];L(bn)}}function L(bn){var bp=/image.*/;if(!bn.type.match(bp)){return false}var bo=new FileReader();bo.onloadend=function(){var bs=jQuery("#favicon_canvas")[0];var br=bs.getContext("2d");var bq=document.createElement("img");bq.onload=function(){br.drawImage(bq,0,0,16,16);var bw=br.getImageData(0,0,16,16).data;var bx;for(bx=1;bx<=p;bx++){var bu;for(bu=1;bu<=az;bu++){var bv=(bx-1)*16*4+(bu-1)*4;var bt=aO(bw[bv])+aO(bw[bv+1])+aO(bw[bv+2])+aO(bw[bv+3]);aG(bx,bu,bt)}}};bq.src=bo.result};bo.readAsDataURL(bn);return true}function a0(){if(jQuery("#x_hotspot").length&&jQuery("#y_hotspot").length){K(jQuery("#y_hotspot").val(),jQuery("#x_hotspot").val())}else{K(0,0)}jQuery("#example1").click(function(){return(false)});jQuery("#example2").click(function(){return(false)});jQuery("#link_bigger").click(function(){aj(true,"slow");return(false)});jQuery("#link_smaller").click(function(){aj(false,"slow");return(false)});jQuery("#add_shadow_button").click(function(){b();return(false)});jQuery("#download_cursor_button").click(function(){aH();return(false)})}function aj(bn,bo){if(bn){jQuery("#link_bigger").fadeOut(bo,function(){jQuery(".outer_element").show();var bp=(20+2)*32;jQuery("#big_icon").css("width",bp+"px");jQuery(".tag_cloud").parent().removeClass("large_box").addClass("extra_large_box");jQuery("#link_smaller").fadeIn(bo)})}else{jQuery("#link_smaller").fadeOut(bo,function(){var bp=(20+2)*16;jQuery("#big_icon").css("width",bp+"px");jQuery(".outer_element").hide();jQuery(".tag_cloud").parent().removeClass("extra_large_box").addClass("large_box");jQuery("#link_bigger").fadeIn(bo)})}}function A(bp,br){var bt=parseInt(bp.substr(6,2),16)/255;var bs=aO(parseInt(bp.substr(0,2),16)*bt+parseInt(br.substr(0,2),16)*(1-bt));var bq=aO(parseInt(bp.substr(2,2),16)*bt+parseInt(br.substr(2,2),16)*(1-bt));var bn=aO(parseInt(bp.substr(4,2),16)*bt+parseInt(br.substr(4,2),16)*(1-bt));var bo=aO(parseInt(bp.substr(6,2),16)+parseInt(br.substr(6,2),16)*(1-bt));return(bs+bq+bn+bo)}function a5(){if(!bd){return}if(!e){e=0}e++;if(e>(u.length-1)){e=0}jQuery("#moving_cursor").delay(u[e].delay).animate({left:(u[e].left-ar)+"px",top:(u[e].top-ax)+"px"},{duration:aV,complete:a5});if(e===0){jQuery("#example2").prop("checked",true)}else{if(e===2){jQuery("#example1").prop("checked",true)}}}function K(bo,bn){ax=bo;ar=bn;jQuery("#hotspot_cross").remove();jQuery('<img src="/images/tools/hotspot.png" id="hotspot_cross" style="height: 16px; width: 16px; position: absolute; top: 1px; left: 2px;" alt="" />').insertAfter("#big-r"+(parseInt(bo,10)+1)+"c"+(parseInt(bn,10)+1))}function a6(){az=parseInt(jQuery("#image_width").val(),10);p=parseInt(jQuery("#image_height").val(),10);z();var bn="Width: "+az+", Height: "+p+' <a id="change_size_link" href="#">Change Size</a>';jQuery("#resizer").html(bn);jQuery("#change_size_link").click(function(){al();return(false)});return false}function aO(bn){bn=Math.round(Math.min(Math.max(0,bn),255));return("0123456789ABCDEF".charAt((bn-bn%16)/16)+"0123456789ABCDEF".charAt(bn%16))}function z(){bg(p,az);C(p,az);S(a3,p,az);J();var bn=d();a9(bn);aE()}function S(bq,bs,br){var bn=[];var bt;for(bt=1;bt<=bq;bt++){bn[bt]=[];var bp;for(bp=1;bp<=bs;bp++){bn[bt][bp]=[];var bo;for(bo=1;bo<=br;bo++){if(bh[bt]&&bh[bt][bp]&&bh[bt][bp][bo]){bn[bt][bp][bo]=bh[bt][bp][bo]}else{bn[bt][bp][bo]="00000000"}}}}bh=bn}function bg(bq,bp){var bo="";var bs=(20+2)*bp;jQuery("#big_icon").css("width",bs+"px");var br;for(br=1;br<=bq;br++){var bn;for(bn=1;bn<=bp;bn++){bo+=g(br,bn)}bo+='<div style="clear: left;"></div>'}jQuery("#big_icon").html(bo)}function C(br,bq){var bn='<table border="0" cellpadding="0" cellspacing="0" style="width: '+bq+'px;">';var bp;for(bp=1;bp<=br;bp++){bn+="<tr>";var bo;for(bo=1;bo<=bq;bo++){bn+='<td id="small-r'+bp+"c"+bo+'" style="width: 1px; height: 1px">';bn+="</td>"}bn+="</tr>"}bn+="</table>";jQuery("#preview_image").html(bn);jQuery("#preview_image").css("width",bq+"px")}function g(bp,bn){var bo="";bo+='<div class="big_icon_background">';bo+='<div class="big_icon_element';bo+='" id="big-r'+bp+"c"+bn+'" />';bo+="</div>";return(bo)}function v(){if(!p){var bn=jQuery("#big_icon .big_icon_background").length;var bo=jQuery("#big_icon").children().length;p=bo-bn;az=bn/p}}function a1(){if(F()){image_editor.frame_duration_changed();if(a3>1){bm(1)}}jQuery("#animation_link_show").click(function(){bm(1);return(false)});jQuery("#animation_link_hide").click(function(){bm(0);return(false)})}function aU(){jQuery("#publish_icon_button").click(function(){bc();return(false)});jQuery("#color_hex_string").click(function(){color_picker.color_popup();return(false)});jQuery("#download_image_button").click(function(){E();return(false)});jQuery("#change_size_link").click(function(){al();return(false)});jQuery("#download_icon_button").click(function(){bb();return(false)});jQuery("#animation_previous_arrow").click(function(){bl();return(false)});jQuery("#animation_next_arrow").click(function(){bk();return(false)});jQuery("#animation_clear_frame").click(function(){U();return(false)});jQuery("#animation_append_new_frame").click(function(){M();return(false)});jQuery("#animation_copy_previous_frame").click(function(){G();return(false)});jQuery("#animation_delete_frame").click(function(){ak();return(false)})}function aE(){var bo;for(bo=1;bo<=p;bo++){var bn;for(bn=1;bn<=az;bn++){T[bo][bn].on("mousedown",c);bi[bo][bn].on("mousedown",c);T[bo][bn].on("mousemove",aN);bi[bo][bn].on("mousemove",aN);T[bo][bn].on("mouseup",R);bi[bo][bn].on("mouseup",R)}}jQuery(document.body).on("mouseup",at);jQuery("#big_icon").on("contextmenu",function(){return false})}function a7(){an();v();O();color_picker.initialize();aX();I();aP=1;w=0;J();var bn=d();aF();a1();if(jQuery("#favicon_canvas").length&&(typeof(jQuery("#favicon_canvas")[0].getContext)==="function")){ad=1;aY=jQuery("#favicon_canvas")[0].getContext("2d")}a9(bn);aE();if(ad){av()}if(jQuery("#hotspot").length){a0()}aU();if(aq){jQuery("body").on("dragover",a8);jQuery("body").on("drop",ap);jQuery.event.props.push("dataTransfer")}}jQuery.preLoadImages=function(){var bo=arguments.length;var bp;for(bp=bo;bp--;){var bn=document.createElement("img");bn.src=arguments[bp];X.push(bn)}}}());jQuery(function(){image_editor.initialize_page()});